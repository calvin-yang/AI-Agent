# AI Agent - è”ç½‘æ™ºèƒ½åŠ©æ‰‹

åŸºäºFlask + DeepSeek APIçš„è”ç½‘AIæ™ºèƒ½åŠ©æ‰‹ï¼Œèƒ½å¤Ÿè‡ªåŠ¨åˆ¤æ–­é—®é¢˜æ˜¯å¦éœ€è¦å®æ—¶ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œè”ç½‘æœç´¢å’Œåˆ†æã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ¤– **æ™ºèƒ½åˆ†æ**: è‡ªåŠ¨åˆ¤æ–­é—®é¢˜æ˜¯å¦éœ€è¦è”ç½‘æœç´¢
- ğŸ” **å¤šå¼•æ“æœç´¢**: æ”¯æŒDuckDuckGoå’ŒGoogleæœç´¢
- ğŸ•·ï¸ **å†…å®¹çˆ¬å–**: è‡ªåŠ¨çˆ¬å–ç½‘é¡µå†…å®¹è¿›è¡Œåˆ†æ
- ğŸ§  **AIåˆ†æ**: ç»“åˆæœç´¢ç»“æœç”Ÿæˆå‡†ç¡®å›ç­”
- ğŸ’¬ **å‹å¥½ç•Œé¢**: ç°ä»£åŒ–çš„èŠå¤©ç•Œé¢
- âš¡ **å¼‚æ­¥å¤„ç†**: æ”¯æŒé«˜å¹¶å‘ï¼Œå®æ—¶è¿›åº¦æ˜¾ç¤º
- ğŸ”„ **å®æ—¶é€šä¿¡**: WebSocketå®æ—¶æ›´æ–°å¤„ç†çŠ¶æ€
- ğŸ§ª **å®Œæ•´æµ‹è¯•**: åŒ…å«å®Œæ•´çš„å•å…ƒæµ‹è¯•

## é¡¹ç›®ç»“æ„

```
ai_agent_2/
â”œâ”€â”€ app/                          # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ celery_app.py            # Celeryé…ç½®
â”‚   â”œâ”€â”€ tasks.py                 # å¼‚æ­¥ä»»åŠ¡
â”‚   â”œâ”€â”€ blueprints/               # Flaskè“å›¾
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ chat.py              # èŠå¤©ç›¸å…³è·¯ç”±
â”‚   â”‚   â””â”€â”€ api.py               # APIæ¥å£
â”‚   â”œâ”€â”€ services/                 # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ deepseek_service.py  # DeepSeek APIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ search_service.py    # æœç´¢å¼•æ“æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ crawler_service.py   # ç½‘é¡µçˆ¬è™«æœåŠ¡
â”‚   â”‚   â””â”€â”€ ai_agent_service.py  # AI Agentæ ¸å¿ƒæœåŠ¡
â”‚   â””â”€â”€ templates/                # æ¨¡æ¿æ–‡ä»¶
â”‚       â”œâ”€â”€ base.html
â”‚       â””â”€â”€ chat.html
â”œâ”€â”€ test/                         # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_deepseek_service.py
â”‚   â”œâ”€â”€ test_search_service.py
â”‚   â”œâ”€â”€ test_crawler_service.py
â”‚   â”œâ”€â”€ test_ai_agent_service.py
â”‚   â”œâ”€â”€ test_app.py
â”‚   â””â”€â”€ run_tests.py
â”œâ”€â”€ app.py                        # åº”ç”¨å…¥å£
â”œâ”€â”€ scripts/                      # å¯åŠ¨è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ start.py                 # åŸºç¡€å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start_async.py           # å¼‚æ­¥å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start_worker.py          # Workerå¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start_distributed.py     # åˆ†å¸ƒå¼å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ install.py               # å®‰è£…è„šæœ¬
â”‚   â””â”€â”€ update_dependencies.py   # ä¾èµ–æ›´æ–°è„šæœ¬
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ nginx.conf               # Nginxé…ç½®æ–‡ä»¶
â”œâ”€â”€ docker-compose.yml           # Dockerç¼–æ’æ–‡ä»¶
â”œâ”€â”€ docker-compose-distributed.yml # åˆ†å¸ƒå¼Dockerç¼–æ’æ–‡ä»¶
â”œâ”€â”€ Dockerfile                   # Dockeré•œåƒæ–‡ä»¶
â”œâ”€â”€ requirements.txt              # ä¾èµ–åŒ…
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
```

## å®‰è£…å’Œè¿è¡Œ

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

**æ³¨æ„**: å¦‚æœé‡åˆ° `duckduckgo_search` åŒ…çš„è­¦å‘Šï¼Œè¯·è¿è¡Œä¾èµ–æ›´æ–°è„šæœ¬ï¼š

```bash
python scripts/update_dependencies.py
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶å¹¶é…ç½®DeepSeek APIå¯†é’¥ï¼š

```bash
export DEEPSEEK_API_KEY="your-deepseek-api-key"
export SECRET_KEY="your-secret-key"
```

### 3. è¿è¡Œåº”ç”¨

#### æ–¹å¼ä¸€ï¼šå¼‚æ­¥æ¨¡å¼ï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨å¼‚æ­¥æœåŠ¡ï¼ˆåŒ…å«Redisã€Celery Workerå’ŒFlaskåº”ç”¨ï¼‰
python scripts/start_async.py
```

#### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨å„ä¸ªç»„ä»¶

```bash
# 1. å¯åŠ¨Redisï¼ˆå¦‚æœæœªè¿è¡Œï¼‰
redis-server

# 2. å¯åŠ¨Celery Workerï¼ˆæ–°ç»ˆç«¯ï¼‰
python scripts/start_worker.py

# 3. å¯åŠ¨Flaskåº”ç”¨ï¼ˆæ–°ç»ˆç«¯ï¼‰
python app.py
```

#### æ–¹å¼ä¸‰ï¼šDockeréƒ¨ç½²

```bash
# ä½¿ç”¨Docker Composeä¸€é”®å¯åŠ¨
docker-compose up -d
```

#### æ–¹å¼å››ï¼šåˆ†å¸ƒå¼éƒ¨ç½²

```bash
# å¯åŠ¨åˆ†å¸ƒå¼æœåŠ¡ï¼ˆ3ä¸ªWebå®ä¾‹ + 3ä¸ªWorkerå®ä¾‹ï¼‰
python scripts/start_distributed.py --instances 3 --workers 3

# ä½¿ç”¨Docker Composeå¯åŠ¨åˆ†å¸ƒå¼æœåŠ¡
docker-compose -f docker-compose-distributed.yml up -d
```

åº”ç”¨å°†åœ¨ `http://localhost:8002` å¯åŠ¨ã€‚

## ä½¿ç”¨è¯´æ˜

### èŠå¤©ç•Œé¢

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:8002`
2. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ‚¨çš„é—®é¢˜
3. AIä¼šè‡ªåŠ¨åˆ†æé—®é¢˜æ˜¯å¦éœ€è¦è”ç½‘æœç´¢
4. å¦‚æœéœ€è¦ï¼Œä¼šè‡ªåŠ¨æœç´¢å¹¶åˆ†æç›¸å…³å†…å®¹
5. æœ€ç»ˆç»™å‡ºå‡†ç¡®ã€åŠæ—¶çš„å›ç­”

### APIæ¥å£

#### 1. èŠå¤©æ¥å£
```bash
POST /chat
Content-Type: application/json

{
    "question": "ä»Šå¤©æœ‰ä»€ä¹ˆæœ€æ–°æ–°é—»ï¼Ÿ"
}
```

#### 2. é—®é¢˜åˆ†ææ¥å£
```bash
POST /api/analyze
Content-Type: application/json

{
    "question": "ä»€ä¹ˆæ˜¯Pythonï¼Ÿ"
}
```

#### 3. æœç´¢æ¥å£
```bash
POST /api/search
Content-Type: application/json

{
    "keywords": "äººå·¥æ™ºèƒ½"
}
```

#### 4. çˆ¬å–æ¥å£
```bash
POST /api/crawl
Content-Type: application/json

{
    "urls": ["http://example.com"]
}
```

#### 5. å®Œæ•´å¤„ç†æ¥å£
```bash
POST /api/process
Content-Type: application/json

{
    "question": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
}
```

## å·¥ä½œæµç¨‹

1. **é—®é¢˜åˆ†æ**: AIåˆ†æç”¨æˆ·é—®é¢˜ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦è”ç½‘æœç´¢
2. **å…³é”®è¯æå–**: å¦‚æœéœ€è¦æœç´¢ï¼Œæå–ç›¸å…³æœç´¢å…³é”®è¯
3. **å¤šå¼•æ“æœç´¢**: ä½¿ç”¨DuckDuckGoå’ŒGoogleè¿›è¡Œæœç´¢
4. **å†…å®¹çˆ¬å–**: çˆ¬å–æœç´¢ç»“æœä¸­çš„ç½‘é¡µå†…å®¹
5. **AIåˆ†æ**: ç»“åˆåŸå§‹é—®é¢˜å’Œæœç´¢ç»“æœï¼Œç”Ÿæˆæœ€ç»ˆå›ç­”
6. **ç»“æœå±•ç¤º**: å‘ç”¨æˆ·å±•ç¤ºå›ç­”å’Œç›¸å…³æ¥æº

## é…ç½®è¯´æ˜

### æœç´¢å¼•æ“é…ç½®
```python
SEARCH_ENGINES = {
    'duckduckgo': {
        'enabled': True,
        'weight': 0.6,
        'max_results': 5
    },
    'google': {
        'enabled': True,
        'weight': 0.4,
        'max_results': 3
    }
}
```

### çˆ¬è™«é…ç½®
```python
CRAWLER_CONFIG = {
    'timeout': 10,
    'max_content_length': 50000,  # æå–çš„æ–‡æœ¬å†…å®¹æœ€å¤§é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰
    'user_agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
}
```

### AIåˆ†æé…ç½®
```python
AI_ANALYSIS_CONFIG = {
    'max_context_length': 8000,
    'temperature': 0.7
}
```

## æµ‹è¯•

### å•å…ƒæµ‹è¯•

è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼š

```bash
python test/run_tests.py
```

è¿è¡Œç‰¹å®šæµ‹è¯•ï¼š

```bash
python -m unittest test.test_deepseek_service
python -m unittest test.test_search_service
python -m unittest test.test_crawler_service
python -m unittest test.test_ai_agent_service
python -m unittest test.test_app
```

### é…ç½®æµ‹è¯•

æµ‹è¯•Celeryå’ŒRedisé…ç½®ï¼š

```bash
python test/test_celery_config.py
```

### æ€§èƒ½æµ‹è¯•

æµ‹è¯•å¼‚æ­¥æ¶æ„æ€§èƒ½ï¼š

```bash
python test/test_performance.py
```

### åˆ†å¸ƒå¼æµ‹è¯•

æµ‹è¯•åˆ†å¸ƒå¼æ¶æ„ï¼š

```bash
python test/test_distributed.py
```

## æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **Webæ¡†æ¶**: Flask + Flask-SocketIO
- **å¼‚æ­¥ä»»åŠ¡**: Celery + Redis
- **AIæœåŠ¡**: DeepSeek API
- **æœç´¢å¼•æ“**: DuckDuckGo, Google
- **ç½‘é¡µè§£æ**: BeautifulSoup4, lxml
- **HTTPè¯·æ±‚**: requests
- **å®æ—¶é€šä¿¡**: WebSocket (SocketIO)

### å‰ç«¯æŠ€æœ¯
- **UIæ¡†æ¶**: Bootstrap 5
- **å›¾æ ‡**: Font Awesome
- **Markdownæ¸²æŸ“**: marked.js
- **ä»£ç é«˜äº®**: Prism.js
- **å®æ—¶é€šä¿¡**: Socket.IO Client

### éƒ¨ç½²æŠ€æœ¯
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **è¿›ç¨‹ç®¡ç†**: Celery Worker
- **ç¼“å­˜/æ¶ˆæ¯é˜Ÿåˆ—**: Redis
- **è´Ÿè½½å‡è¡¡**: Nginx
- **åˆ†å¸ƒå¼é€šä¿¡**: Redis + SocketIO
- **ç›‘æ§**: Flower
- **æµ‹è¯•**: unittest

## åˆ†å¸ƒå¼æ¶æ„

### æ¶æ„ç‰¹ç‚¹

- **æ°´å¹³æ‰©å±•**: æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²ï¼Œè½»æ¾æ‰©å±•å¤„ç†èƒ½åŠ›
- **è´Ÿè½½å‡è¡¡**: Nginxè‡ªåŠ¨åˆ†å‘è¯·æ±‚åˆ°ä¸åŒå®ä¾‹
- **å®æ—¶é€šä¿¡**: Redisä½œä¸ºSocketIOæ¶ˆæ¯ä»£ç†ï¼Œæ”¯æŒè·¨å®ä¾‹é€šä¿¡
- **ä»»åŠ¡é˜Ÿåˆ—**: Celery + Rediså®ç°åˆ†å¸ƒå¼ä»»åŠ¡å¤„ç†
- **ç›‘æ§ç®¡ç†**: Floweræä¾›ä»»åŠ¡ç›‘æ§å’Œç®¡ç†ç•Œé¢

### éƒ¨ç½²æ¶æ„å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ç”¨æˆ·è¯·æ±‚   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚   Nginx     â”‚
                    â”‚ è´Ÿè½½å‡è¡¡å™¨   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ Webå®ä¾‹1 â”‚        â”‚ Webå®ä¾‹2 â”‚        â”‚ Webå®ä¾‹3 â”‚
   â”‚ :8002   â”‚        â”‚ :8003   â”‚        â”‚ :8004   â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚    Redis    â”‚
                    â”‚ æ¶ˆæ¯ä»£ç†/ç¼“å­˜ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚Worker1  â”‚        â”‚Worker2  â”‚        â”‚Worker3  â”‚
   â”‚ä»»åŠ¡å¤„ç†  â”‚        â”‚ä»»åŠ¡å¤„ç†  â”‚        â”‚ä»»åŠ¡å¤„ç†  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ€§èƒ½ä¼˜åŠ¿

- **é«˜å¯ç”¨æ€§**: å•ç‚¹æ•…éšœä¸å½±å“æ•´ä½“æœåŠ¡
- **é«˜å¹¶å‘**: æ”¯æŒæ•°åƒä¸ªå¹¶å‘è¿æ¥
- **å¼¹æ€§æ‰©å±•**: å¯æ ¹æ®è´Ÿè½½åŠ¨æ€è°ƒæ•´å®ä¾‹æ•°é‡
- **å®æ—¶ç›‘æ§**: å®Œæ•´çš„ä»»åŠ¡å’Œæ€§èƒ½ç›‘æ§

## æ•…éšœæ’é™¤

### Workerå¯åŠ¨å¤±è´¥

å¦‚æœé‡åˆ° `'NoneType' object has no attribute 'Redis'` é”™è¯¯ï¼š

1. **æ£€æŸ¥ç¯å¢ƒå˜é‡**ï¼š
   ```bash
   python test/test_worker.py
   ```

2. **ç¡®ä¿.envæ–‡ä»¶å­˜åœ¨**ï¼š
   ```bash
   cp env.example .env
   # ç¼–è¾‘.envæ–‡ä»¶ï¼Œè®¾ç½®DEEPSEEK_API_KEY
   ```

3. **æ£€æŸ¥RedisæœåŠ¡**ï¼š
   ```bash
   redis-cli ping
   # åº”è¯¥è¿”å› PONG
   ```

4. **æ‰‹åŠ¨è®¾ç½®ç¯å¢ƒå˜é‡**ï¼š
   ```bash
   export DEEPSEEK_API_KEY="your-api-key"
   python celery_worker.py
   ```

### å¸¸è§é—®é¢˜

1. **Redisè¿æ¥å¤±è´¥**ï¼š
   - ç¡®ä¿RedisæœåŠ¡æ­£åœ¨è¿è¡Œ
   - æ£€æŸ¥ç«¯å£6379æ˜¯å¦è¢«å ç”¨
   - éªŒè¯Redisé…ç½®

2. **ä»»åŠ¡æ‰§è¡Œå¤±è´¥**ï¼š
   - æ£€æŸ¥DeepSeek APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
   - éªŒè¯ç½‘ç»œè¿æ¥
   - æŸ¥çœ‹Workeræ—¥å¿—

3. **SocketIOè¿æ¥é—®é¢˜**ï¼š
   - ç¡®ä¿Redisä½œä¸ºæ¶ˆæ¯ä»£ç†æ­£å¸¸è¿è¡Œ
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
   - éªŒè¯WebSocketæ”¯æŒ

## æ³¨æ„äº‹é¡¹

1. éœ€è¦æœ‰æ•ˆçš„DeepSeek APIå¯†é’¥
2. æœç´¢å¼•æ“å¯èƒ½å—åˆ°è®¿é—®é™åˆ¶
3. ç½‘é¡µçˆ¬å–éœ€è¦éµå®ˆrobots.txtè§„åˆ™
4. åˆ†å¸ƒå¼éƒ¨ç½²éœ€è¦ç¡®ä¿RedisæœåŠ¡ç¨³å®šè¿è¡Œ
5. å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®é€‚å½“çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
6. ç›‘æ§åœ°å€: http://localhost:5555 (Flower)

## è®¸å¯è¯

MIT License
